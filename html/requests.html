<!DOCTYPE html>
<html lang="en" class="sl-theme-dark">
  <head>
    <title>Requests - Fsh api</title>
    <!-- Boiler plate------ -->
    <link rel="icon" href="https://fsh.plus/fsh.png" type="image/png">
    <meta name="description" content="Fsh api requests, easy to use online api checker">
    <!-- ------- -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://fsh.plus/fsh.png"/>
    <meta name="theme-color" content="#a89c9b">
    <!-- ------------------ -->
    <link rel="manifest" href="/requests.json">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.1/cdn/themes/dark.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.1/cdn/shoelace.js" ></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.1/cdn/components/badge/badge.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.1/cdn/components/details/details.js"></script>
    <style>
      * {
        font-family: Arial;
      }
      .rab {
        background-color:#333;
        margin:4px;
        padding:4px;
        border-radius:1rem;
        height: 20%;
        max-height: 35px;
        display: flex;
      }
      option {
        color: #fff;
        background-color: #000;
      }
      body {
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
      }
      sl-details {
        max-height: 70vh;
        overflow: auto;
      }
      pre {
        white-space: -moz-pre-wrap;
        white-space: -pre-wrap;
        white-space: -o-pre-wrap;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      iframe {
        width: 100%;
        height: 55vh;
      }
      input {
        min-width:0;
      }
      .card-api {
        background-color: #444;
        padding: 5px;
        border-radius: 0.5rem;
        margin-bottom: 5px;
        cursor: pointer;
        transition: 1s;
      }
      .card-api:hover {
        background-color: #333;
      }
    </style>
  </head>
  <body>
    <sl-split-panel position="25" style="height:100vh;--min:25%;--max:75%;" snap="50%">
      <div slot="start" style="overflow-y:auto">
        <sl-tab-group>
          <sl-tab slot="nav" panel="param">Params</sl-tab>
          <sl-tab slot="nav" panel="body">Body</sl-tab>
          <sl-tab slot="nav" panel="head">Headers</sl-tab>
          <sl-tab slot="nav" panel="auth">Auth</sl-tab>

          <sl-tab-panel name="param"><div id="para">
            <sl-button-group>
              <sl-input placeholder="Key"></sl-input>
              <sl-input placeholder="Value"></sl-input>
            </sl-button-group>
          </div></sl-tab-panel>
          <sl-tab-panel name="body"><sl-textarea id="body" resize="auto" style="width: 100%;height: 100%;box-sizing: border-box;"></sl-textarea></sl-tab-panel>
          <sl-tab-panel name="head"><div id="hed">
            <sl-button-group>
              <sl-input placeholder="Key"></sl-input>
              <sl-input placeholder="Value"></sl-input>
            </sl-button-group>
          </div></sl-tab-panel>
          <sl-tab-panel name="auth">
            <div id="AuthIn"><p>No auth</p></div>
            <sl-select value="None" id="auth" style="position:absolute;bottom:0;width:25%;">
              <sl-option value="None">None</sl-option>
              <sl-option value="Basic">Basic</sl-option>
              <sl-option value="Bearer">Bearer</sl-option>
              <sl-option value="Url">Url @</sl-option>
            </sl-select>
            <script>
              document.getElementsByTagName('sl-select')[0].addEventListener('sl-change', function(e) {
                switch (document.getElementsByTagName('sl-select')[0].value) {
                  case 'None':
                    document.getElementById('AuthIn').innerHTML = '<p>No auth</p>'
                    break;
                  case 'Basic':
                    document.getElementById('AuthIn').innerHTML = '<p>Basic auth</p><sl-input id="BU" placeholder="User"></sl-input><sl-input id="BP" placeholder="Password" type="password" password-toggle></sl-input>'
                    break;
                  case 'Bearer':
                    document.getElementById('AuthIn').innerHTML = '<p>Bearer token</p><label>Prefix:</label><select id="BP" value="Bearer"><option value="Bearer">Bearer</option><option value="Bot">Bot</option><option value="">None</option></select><sl-input id="BT" placeholder="Token" type="password" password-toggle></sl-input>'
                    break;
                  case 'Url':
                    document.getElementById('AuthIn').innerHTML = '<p>Url @ auth</p><sl-input id="UU" placeholder="User"></sl-input><sl-input id="UP" placeholder="Password" type="password" password-toggle></sl-input>'
                    break;
                }
              })
            </script>
          </sl-tab-panel>
        </sl-tab-group>
      </div>
      <div slot="end" style="overflow-y:auto">
        <div class="rab">
          <select id="type" value="GET" style="border:none;background:none;">
            <option value="GET">GET</option>
            <option value="HEAD">HEAD</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="CONNECT">CONNECT</option>
            <option value="OPTIONS">OPTIONS</option>
            <option value="TRACE">TRACE</option>
            <option value="PATCH">PATCH</option>
          </select>
          <sl-divider vertical style="--color:#666"></sl-divider>
          <input id="url" placeholder="https://fsh.plus" style="border:none;background:none;flex: 1;" onkeyup="if(event.key=='Enter'){send()}">
          <button onclick="document.getElementById('apis').showModal()" style="margin-right:5px;border-radius:0.75rem;border:none;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="15" fill="#fff"><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg></button>
          <dialog style="border-radius:0.5rem" id="apis">
            <h1 style="margin:0">Fsh endpoints</h1>
            <div id="lis" style="max-height:75vh;overflow-y:auto;border:2px #ccc solid;border-radius:0.5rem;padding:10px;padding-top:-20px;"></div>
            <script>
              fetch('/apis').then(async da => {
                da = await da.json();
                document.getElementById('lis').innerHTML = Object.keys(da.endpoints).map(ee => {
                  return `<div onclick="document.getElementById('url').value='api.fsh.plus/${ee}';document.getElementById('type').value='${da.endpoints[ee].type.toUpperCase()}';" class="card-api">
  <p style="margin:0;">/${ee} | ${da.endpoints[ee].category}</p>
  <label style="cursor:pointer">${da.endpoints[ee].info}</label>
</div>`
                }).join('')
              })
            </script>
          </dialog>
          <button onclick="send()" style="border-radius:0.75rem;border:none;height:100%;">Send <svg xmlns="http://www.w3.org/2000/svg" style="margin-bottom:-3px;fill:#fff;" width="17" viewBox="0 0 512 512"><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg></button>
        </div>
        <p id="res"></p>
      </div>
    </sl-split-panel>
    <script>
      function send() {
        // Fetch settings
        let url = document.getElementById('url').value;
        url = (url.includes('://') ? '' : 'https://') + url;
        if (url == "fsh") {
          alert('fsh')
          return;
        }
        let con = {
          method: document.getElementById('type').value,
          headers: {
            Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
            "Accept-Language": "en;q=1.0",
            "sec-ch-ua": '"Not_A Brand";v="99", "Google Chrome";v="109", "Chromium";v="109"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"Windows"',
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "none",
            "sec-fetch-user": "?1",
            "sec-gpc": "1",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"
          }
        }
        // Fetch body
        if (!['GET','HEAD'].includes(con.method)) {
          con.body = document.getElementById('body').value
        }
        // Params
        url = url+'?'+Array.from(document.getElementById('para').children).map(e => `${e.children[0].value}=${e.children[1].value}`).filter(e => e != '=').join('&')
        // Headers
        Array.from(document.getElementById('hed').children).forEach(e => {
          if(e.children[0].value.length) con.headers[e.children[0].value] = e.children[1].value
        })
        // Auth
        function b64EncodeUnicode(str) {
          return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
            function toSolidBytes(match, p1) {
              return String.fromCharCode('0x' + p1);
          }));
        }
        if (document.getElementsByTagName('sl-select')[0].value != 'None') {
          switch(document.getElementsByTagName('sl-select')[0].value) {
            case 'Basic':
              con.headers.Authorization = 'Basic '+b64EncodeUnicode(document.getElementById('BU').value+":"+document.getElementById('BP').value)
              break;
            case 'Bearer':
              con.headers.Authorization = document.getElementById('BP').value+(document.getElementById('BP').value.length ? ' ' : '')+document.getElementById('BT').value;
              break;
            case 'Url':
              url = url.replace('://','://'+document.getElementById('UU').value+'.'+document.getElementById('UP').value+'@')
              break;
          }
        }
        // The fetch
        fetch('/request?url='+encodeURIComponent(url), {method:'post',body:JSON.stringify(con)}).then(async e => {
          e = await e.json();
         
          let s = String(e.status);
          let q = e.headers['content-type'].split(';')[0];
          let x = "";
          for (var pair of Object.entries(e.headers)) {
            x += `<b>${pair[0]}</b>: <label style="color:#ccc">${pair[1]}</label>\n`;
          }
          let y = e.content;
          document.getElementById('res').innerHTML = `<label>Response</label>
<sl-badge variant="${['neutral','primary','success','warning','danger','danger'][s.split('')[0]] || 'neutral'}">${s}</sl-badge>
<sl-badge variant="${e.time > 500 ? 'danger' : 'primary'}">${e.time}ms</sl-badge>
<sl-badge variant="neutral">${q}</sl-badge>
<sl-details summary="Headers"><pre>${x}</pre></sl-details>
<sl-details summary="Response text" class="dso"><pre>${y.replaceAll('<','&lt;').replaceAll('>','&gt;')}</pre></sl-details>
<sl-details summary="IFrame"><p>Links adapted to point to site</p><iframe id="ifr"></iframe></sl-details>`;
          if (q.includes('image/')) {
            document.getElementById('ifr').src = url
          } else {
            y = y.replaceAll(/(href|src)="(?!http:\/\/|https:\/\/).+?"/g, function(match) {
              if (match.startsWith('//')) {return match.replace('"', '"https:');}
              let uri = (url.split('?')[0] + '/');
              if (match.includes('="/')) {return match.replace('"', '"'+uri).replace('://','||').replace('//','/').replace('||','://');}
              return match.replace('"', '"'+uri).replace(/(?<!\/|\/\/|:)\/.+?\/\.\//, '/').replace('/./', '/').replace(/(?!\/)\/.+?\/\..\//, '/')
            })
            y = y.replace('data-color-mode="auto"','data-color-mode="dark"')
           
            document.getElementById('ifr').contentDocument.write(y)
          }
        })
      }

      document.getElementById('para').addEventListener('input', function (event) {
        const target = event.target;
        if (target.tagName.toLowerCase() === 'sl-input') {
          const parentInputGroup = target.parentElement;
          if (parentInputGroup.parentElement.children[parentInputGroup.parentElement.children.length - 1] === parentInputGroup) {
            document.getElementById('para').insertAdjacentHTML('beforeend', `<sl-button-group>
  <sl-input placeholder="Key"></sl-input>
  <sl-input placeholder="Value"></sl-input>
</sl-button-group>`)
          } else {
            if (!parentInputGroup.children[0].value && !parentInputGroup.children[1].value) {
              parentInputGroup.remove()
            }
          }
        }
      });

      document.getElementById('hed').addEventListener('input', function (event) {
        const target = event.target;
        if (target.tagName.toLowerCase() === 'sl-input') {
          const parentInputGroup = target.parentElement;
          if (parentInputGroup.parentElement.children[parentInputGroup.parentElement.children.length - 1] === parentInputGroup) {
            document.getElementById('hed').insertAdjacentHTML('beforeend', `<sl-button-group>
  <sl-input placeholder="Key"></sl-input>
  <sl-input placeholder="Value"></sl-input>
</sl-button-group>`)
          } else {
            if (!parentInputGroup.children[0].value && !parentInputGroup.children[1].value) {
              parentInputGroup.remove()
            }
          }
        }
      });
    </script>
  </body>
</html>